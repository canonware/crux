#!@PYTHON@@python_opts@
################################################################################
#
# <Copyright = jasone>
# <License>
#
################################################################################
#
# Version: Crux <Version = crux>
#
################################################################################

from glob import glob
import re

from distutils.core import setup, Extension
if @enable_cython@:
    from Cython.Distutils import build_ext

ext_modules = []
#Extension('Crux._crux',
#                               sources=glob("@srcroot@/src/Crux/*.c"),
#                               include_dirs=["@srcroot@/include",
#                                             "@objroot@/include"],
#                               extra_compile_args=[@extra_compile_args@]),


if @enable_cython@:
    cy_suffix = "pyx"
    cmdclass = {'build_ext': build_ext}
else:
    cy_suffix = "c"
    cmdclass = {}

if @enable_debug@:
    extra_compile_args = []
else:
    extra_compile_args = ['-DPYREX_WITHOUT_ASSERTIONS']

# Crux.*
for path in glob("@srcroot@/src/Crux/[A-Z_]*.%s" % cy_suffix):
    subpath = re.match(r"@srcroot@/src/(.*)", path).group(1)
    fsplit = re.split(r"[/.]", subpath)
    module = ".".join(fsplit[:-1])
    ext = Extension(
      ".".join(fsplit[:-1]),
      sources=[path],
      include_dirs=["@srcroot@/src", "@srcroot@/src/Crux"],
      extra_compile_args=extra_compile_args
      )
    ext_modules.append(ext)
# Parsing
ext = Extension(
  'Parsing',
  sources=["@srcroot@/src/Parsing.%s" % cy_suffix],
  extra_compile_args=extra_compile_args
  )
ext_modules.append(ext)

setup(
  name = 'Crux',
  version = '@crux_version@',
  description = 'Pylogenetic inference program',
  author = 'Jason Evans',
  author_email = 'jasone@canonware.com',
  url = 'http://www.canonware.com/cgi-bin/hg_crux',
  download_url = 'http://www.canonware.com/cgi-bin/hg_crux',
  package_dir = {'': '@srcroot@/src'},
  packages = ['Crux'],
  ext_modules = ext_modules,
  scripts = ['@objroot@/bin/crux'],
  cmdclass = cmdclass
  )
