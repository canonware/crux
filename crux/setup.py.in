#!@PYTHON@@python_opts@
################################################################################
#
# <Copyright = jasone>
# <License>
#
################################################################################
#
# Version: Crux <Version = crux>
#
################################################################################

from glob import glob

from distutils.core import setup, Extension
if @enable_cython@:
    from Cython.Distutils import build_ext

ext_modules = []
#Extension('Crux._crux',
#                               sources=glob("@srcroot@/src/Crux/*.c"),
#                               include_dirs=["@srcroot@/include",
#                                             "@objroot@/include"],
#                               extra_compile_args=[@extra_compile_args@]),

if @enable_cython@:
    # Crux.*
    for pkg in [x.split("/")[-1].split(".")[0] for x in
      glob("@srcroot@/src/Crux/*.pyx")]:
        ext = Extension('Crux.%s' % pkg,
                        sources=["@srcroot@/src/Crux/%s.pyx" % pkg],
                        include_dirs=["@srcroot@/src", "@srcroot@/src/Crux"])
        ext_modules.append(ext)
    # Parsing
    ext = Extension('Parsing',
                    sources=["@srcroot@/src/Parsing.pyx"])
    ext_modules.append(ext)
    cmdclass = {'build_ext': build_ext}
else:
    # Crux.*
    for pkg in [x.split("/")[-1].split(".")[0] for x in
      glob("@srcroot@/src/Crux/*.c")]:
        ext = Extension('Crux.%s' % pkg,
                        sources=["@srcroot@/src/Crux/%s.c" % pkg],
                        include_dirs=["@srcroot@/src", "@srcroot@/src/Crux"])
        ext_modules.append(ext)
    # Parsing
    ext = Extension('Parsing',
                    sources=["@srcroot@/src/Parsing.c"])
    ext_modules.append(ext)
    cmdclass = {}

setup(name = 'Crux',
      version = '@crux_version@',
      description = 'Pylogenetic inference program',
      author = 'Jason Evans',
      author_email = 'jasone@canonware.com',
      url = 'http://www.canonware.com/cgi-bin/hg_crux',
      download_url = 'http://www.canonware.com/cgi-bin/hg_crux',
      package_dir = {'': '@srcroot@/src'},
      packages = ['Crux'],
      ext_modules = ext_modules,
      scripts = ['@objroot@/bin/crux'],
      cmdclass = cmdclass
      )
